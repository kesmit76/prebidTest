<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Prebid Sovrn Standalone Debug Page</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; padding:16px; }
    #ad-slot { width:300px; height:250px; border:1px solid #333; margin-top:10px; }
    #status { margin-bottom:8px; font-weight:600; }
    #debug { margin-top:12px; white-space:pre-wrap; font-size:12px; color:#222; background:#f6f6f6; padding:8px; border-radius:4px; max-height:300px; overflow:auto; }
    button { margin-right:8px; }
  </style>
</head>
<body>
  <h2>Prebid Sovrn Standalone Debug</h2>
  <div id="status">Status: idle</div>
  <div>
    <button id="btnRun">Run Prebid Auction</button>
    <button id="btnRender">Render Current Winner</button>
    <button id="btnDump">Dump pbjs.getBidResponses()</button>
  </div>

  <div id="ad-slot"></div>

  <div id="debug"></div>

  <!-- IMPORTANT: point this to a Prebid build (local or downloaded) that includes the sovrn adapter -->
  <!-- Example: download a Prebid custom build and place it next to this file as "prebid.js" -->
  <script src="prebid.js"></script>

  <script>
    // Config
    var AD_UNIT_CODE = 'ad-slot';
    var SOVRN_TAGID = 'YOUR_SOVRN_TAG_ID'; // <-- REPLACE THIS

    // Safety: ensure pbjs exists
    window.pbjs = window.pbjs || {};
    pbjs.que = pbjs.que || [];
    pbjs.logging = true;

    // UI helpers
    function setStatus(text) {
      console.log('STATUS:', text);
      var s = document.getElementById('status');
      if (s) s.innerText = 'Status: ' + text;
      appendDebug('STATUS: ' + text);
    }
    function appendDebug(msg) {
      var d = document.getElementById('debug');
      if (!d) return;
      var now = new Date().toISOString().substr(11, 12);
      d.innerText = now + '  ' + msg + '\n' + d.innerText;
    }

    // Ad unit definition (match the div id exactly)
    var adUnits = [{
      code: AD_UNIT_CODE,
      mediaTypes: {
        banner: { sizes: [[300, 250]] }
      },
      bids: [{
        bidder: 'sovrn',
        params: { tagid: SOVRN_TAGID }
      }]
    }];

    // Robust render function with fallbacks
    function safeRenderAd(element, winner) {
      if (!element) {
        setStatus('element not found for rendering');
        return;
      }
      if (!winner) {
        setStatus('no winner provided to safeRenderAd');
        return;
      }

      appendDebug('safeRenderAd() called. bidder=' + winner.bidder + ' cpm=' + (winner.cpm || winner.originalCpm));

      // 1) Preferred: pbjs.renderAd(adElement, adId)
      try {
        if (window.pbjs && typeof pbjs.renderAd === 'function' && winner.adId) {
          pbjs.renderAd(element, winner.adId);
          setStatus('Rendered
