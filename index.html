<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Standalone Sovrn Prebid Test</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; }
    #ad-slot { width: 300px; height: 250px; border: 1px solid #333; }
    #status { margin-top: 12px; font-weight: bold; }
    #debug { margin-top: 12px; padding: 8px; background: #f0f0f0; font-size: 12px; max-height: 200px; overflow: auto; }
  </style>
</head>
<body>
  <h1>Standalone Sovrn Prebid Test With User Sync 1</h1>
  <div id="ad-slot"></div>
  <div id="status">Status: idle</div>
  <pre id="debug"></pre>

  <!-- Prebid.js build including Sovrn adapter -->
  <script src="prebid.js"></script>

  <script>
    var AD_UNIT_CODE = 'ad-slot';
    var SOVRN_TAGID = '1290741'; // <-- Replace with your Sovrn placement/tag ID

    window.pbjs = window.pbjs || {};
    pbjs.que = pbjs.que || [];

    function setStatus(msg) {
      console.log(msg);
      document.getElementById('status').innerText = 'Status: ' + msg;
    }

    function debugLog(obj) {
      document.getElementById('debug').innerText = JSON.stringify(obj, null, 2);
    }

    pbjs.que.push(function() {
      // Define the ad unit
      var adUnits = [{
        code: AD_UNIT_CODE,
        mediaTypes: {
          banner: { sizes: [[300, 250]] }
        },
        bids: [{
          bidder: 'sovrn',
          params: { tagid: SOVRN_TAGID }
        }]
      }];

      pbjs.addAdUnits(adUnits);
      setStatus('Ad units added, requesting bids...');

      pbjs.requestBids({
        timeout: 2000,
        bidsBackHandler: function() {
          setStatus('Bids back â€” checking winner...');
          var winners = pbjs.getHighestCpmBids(AD_UNIT_CODE);
          if (winners && winners.length > 0) {
            var winner = winners[0];
            setStatus('Rendering winning bid from ' + winner.bidder + ' @ CPM: ' + winner.cpm);
            debugLog(winner);

            // Directly inject the ad HTML into the div
            var adSlot = document.getElementById(AD_UNIT_CODE);
            try {
              // Some Sovrn builds use URL-encoded adm
              var html = winner.adm || winner.ad || '';
              adSlot.innerHTML = decodeURIComponent(html);
            } catch(e) {
              console.warn('Error decoding ad HTML, using raw HTML');
              adSlot.innerHTML = winner.adm || winner.ad || '<em>Failed to render</em>';
            }

          } else {
            setStatus('No winning bid returned');
            document.getElementById(AD_UNIT_CODE).innerHTML = '<em>No Sovrn bid</em>';
          }
        }
      });
    });
  </script>
  <img src="https://ap.lijit.com/pixel?gdpr=0&gdpr_consent=0&gpp=0&gpp_sid=0&redir=https%3A%2F%2Fputsreq.com%2FEHmr1ZEHlw4mVrXnsZ3y%3Fbuyeruid%3D%24UID">
  
</body>
</html>
